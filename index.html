<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QuakeCam v2 — 地震×ライブカメラ</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script defer src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- PapaParse -->
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- dayjs (相対時刻用) -->
  <script defer src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/ja.js"></script>
  <style>
    .blur-bg { backdrop-filter: blur(8px); }
    .card { @apply rounded-2xl border border-neutral-800 bg-neutral-900; }
    .btn { @apply text-sm px-3 py-1.5 rounded bg-neutral-800 hover:bg-neutral-700 active:scale-[0.98] transition; }
    .pill { @apply text-xs px-2 py-0.5 rounded border; }
    .hide-scrollbar { scrollbar-width:none; }
    .hide-scrollbar::-webkit-scrollbar { display:none; }
    .drawer-enter { transform: translateY(100%); opacity: 0; }
    .drawer-enter-active { transform: translateY(0); opacity: 1; transition: all .2s ease; }
    .drawer-exit { transform: translateY(0); opacity: 1; }
    .drawer-exit-active { transform: translateY(100%); opacity: 0; transition: all .2s ease; }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-neutral-950/80 blur-bg border-b border-neutral-900">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-base font-semibold">QuakeCam</span>
        <span id="lastUpdated" class="text-xs text-neutral-400">更新: --</span>
      </div>
      <div class="flex items-center gap-2">
        <select id="modeSelect" class="bg-neutral-900 text-sm rounded px-2 py-1 border border-neutral-800">
          <option value="japan">国内</option>
          <option value="global">海外</option>
          <option value="both">両方</option>
        </select>
        <button id="refreshBtn" class="btn">更新</button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 pt-4 pb-24">
    <!-- Tabs content -->
    <section id="tab-dashboard" class="space-y-4">
      <!-- 最新地震カード -->
      <article id="latestCard" class="card p-4"></article>
      <!-- 地図 -->
      <div id="mapWrap" class="card overflow-hidden">
        <div class="flex items-center justify-between px-4 pt-3">
          <div class="text-sm font-medium">震源地マップ</div>
          <label class="text-xs flex items-center gap-2"><input id="autoPan" type="checkbox" class="accent-neutral-300" /> 自動で追従</label>
        </div>
        <div id="map" class="h-72"></div>
      </div>
      <!-- 近傍カメラ -->
      <div class="card p-4">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-medium">震源から近いカメラ</div>
          <div class="text-xs text-neutral-400" id="camMeta">--</div>
        </div>
        <div id="nearbyCameras" class="flex gap-3 overflow-x-auto hide-scrollbar"></div>
      </div>
    </section>

    <section id="tab-feed" class="hidden space-y-3">
      <div class="card p-3 flex flex-wrap items-center gap-2">
        <label class="text-xs">最小M：<input id="minMag" type="number" step="0.1" class="bg-neutral-900 border border-neutral-800 rounded px-2 py-1 w-20" value="3.5"></label>
        <label class="text-xs">期間：
          <select id="timeRange" class="bg-neutral-900 border border-neutral-800 rounded px-2 py-1">
            <option value="1h">1時間</option>
            <option value="24h" selected>24時間</option>
            <option value="7d">7日</option>
          </select>
        </label>
        <button id="applyFilter" class="btn">適用</button>
      </div>
      <div id="feedList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </section>

    <section id="tab-cameras" class="hidden space-y-3">
      <div class="card p-3 flex flex-wrap items-center gap-2">
        <input id="camSearch" placeholder="カメラ検索（名称/タグ）" class="grow bg-neutral-900 border border-neutral-800 rounded px-3 py-2 text-sm" />
        <button id="clearSearch" class="btn">クリア</button>
      </div>
      <div id="cameraGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </section>

    <section id="tab-settings" class="hidden">
      <div class="card p-4 space-y-4">
        <h2 class="text-lg font-semibold">設定</h2>
        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <div class="text-sm font-medium mb-1">表示</div>
            <label class="flex items-center justify-between text-sm mb-2">テーマ
              <select id="theme" class="bg-neutral-900 border border-neutral-800 rounded px-2 py-1">
                <option value="auto">自動</option>
                <option value="dark" selected>ダーク</option>
                <option value="light">ライト</option>
              </select>
            </label>
            <label class="flex items-center justify-between text-sm mb-2">カード密度
              <select id="density" class="bg-neutral-900 border border-neutral-800 rounded px-2 py-1">
                <option value="cozy" selected>標準</option>
                <option value="compact">コンパクト</option>
              </select>
            </label>
          </div>
          <div>
            <div class="text-sm font-medium mb-1">データ</div>
            <label class="flex items-center justify-between text-sm mb-2">自動更新（秒）
              <input id="updateInterval" type="number" min="15" max="300" class="bg-neutral-900 border border-neutral-800 rounded px-2 py-1 w-24" />
            </label>
            <label class="flex items-center justify-between text-sm mb-2">カメラ表示数
              <input id="videoCount" type="number" min="1" max="12" class="bg-neutral-900 border border-neutral-800 rounded px-2 py-1 w-24" />
            </label>
            <label class="flex items-center justify-between text-sm mb-2">帯域セーブ
              <input id="bandwidthSaver" type="checkbox" class="accent-neutral-300" />
            </label>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button id="saveSettings" class="btn">保存</button>
          <button id="resetSettings" class="btn">既定に戻す</button>
        </div>
        <div class="text-xs text-neutral-400" id="settingsInfo"></div>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-0 inset-x-0 z-40 bg-neutral-950/90 blur-bg border-t border-neutral-900">
    <div class="max-w-6xl mx-auto grid grid-cols-4">
      <button data-tab="dashboard" class="tab-btn py-3 text-sm flex flex-col items-center gap-1 text-neutral-300 aria-selected:text-white" aria-selected="true">🏠<span>ダッシュ</span></button>
      <button data-tab="feed" class="tab-btn py-3 text-sm flex flex-col items-center gap-1 text-neutral-300">📰<span>フィード</span></button>
      <button data-tab="cameras" class="tab-btn py-3 text-sm flex flex-col items-center gap-1 text-neutral-300">🎥<span>カメラ</span></button>
      <button data-tab="settings" class="tab-btn py-3 text-sm flex flex-col items-center gap-1 text-neutral-300">⚙️<span>設定</span></button>
    </div>
  </nav>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-20 right-4 opacity-0 pointer-events-none transition"></div>

  <!-- App -->
  <script defer src="main.js"></script>
</body>
</html>